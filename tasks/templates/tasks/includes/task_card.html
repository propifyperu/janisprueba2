<div class="kanban-card" data-task-id="{{ task.id }}" style="border: 1px solid #ddd; border-top: 1px solid rgba(0,0,0,0.05);">
    <div class="kanban-card-title-area" style="background-color: {{ task.color }}; padding: 6px 10px; min-height: 42px; border-bottom: 1px solid rgba(0,0,0,0.1); position: relative;">
        <div class="task-title" style="font-size: 0.85rem; font-weight: 800; color: #fff; line-height: 1.2; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; text-shadow: 0 1px 2px rgba(0,0,0,0.2);">
            {{ task.title }}
        </div>
        {% if user.is_superuser %}
        <div class="card-actions" style="position: absolute; top: 4px; right: 4px; display: flex; gap: 6px; z-index: 10;">
            <div class="edit-pencil" onclick="openEditModal('{{ task.id }}', '{{ task.title|escapejs }}', '{{ task.color }}', '{{ task.assigned_to.id|default:'' }}', '{{ task.description|escapejs }}')" 
                 style="cursor: pointer; font-size: 0.9rem; color: #fff; background: rgba(0,0,0,0.25); width: 30px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" 
                 onmouseover="this.style.background='rgba(0,0,0,0.5)'; this.style.transform='scale(1.1)';" onmouseout="this.style.background='rgba(0,0,0,0.25)'; this.style.transform='scale(1)';">
                <i class="fas fa-pencil-alt"></i>
            </div>
            <div class="delete-task" onclick="deleteTask('{{ task.id }}')" 
                 style="cursor: pointer; font-size: 0.9rem; color: #fff; background: rgba(220, 53, 69, 0.85); width: 30px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;"
                 onmouseover="this.style.background='rgb(220, 53, 69)'; this.style.transform='scale(1.1)';" onmouseout="this.style.background='rgba(220, 53, 69, 0.85)'; this.style.transform='scale(1)';"
                 title="Eliminar tarea">
                <i class="fas fa-trash-alt"></i>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="kanban-card-body" style="padding: 8px 10px; flex: 1; display: flex; align-items: flex-start; background: #fff; gap: 10px;">
        <!-- Avatar y Datos de Usuario (Columna Izquierda) -->
        <div class="user-info-column" style="display: flex; flex-direction: column; align-items: center; width: 85px; flex-shrink: 0; text-align: center; border-right: 1px solid #f0f0f0; padding-right: 5px;">
            {% if task.assigned_to %}
                <div class="avatar-wrapper" style="margin-bottom: 4px;">
                    {% if task.assigned_to.profile.avatar %}
                        <img src="{{ task.assigned_to.profile.avatar.url }}" class="avatar-circle" style="width: 42px; height: 42px; border-radius: 50%; object-fit: cover; border: 2px solid #047d7d;" title="{{ task.assigned_to }}">
                    {% else %}
                        <div class="avatar-circle" style="width: 42px; height: 42px; border-radius: 50%; background: {{ task.color }}; color: #fff; font-size: 16px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid #eee;" title="{{ task.assigned_to }}">
                            {{ task.assigned_to.username|slice:":1"|upper }}
                        </div>
                    {% endif %}
                </div>
                <div class="user-details" style="line-height: 1.1;">
                    <div style="font-size: 0.7rem; font-weight: 700; color: #333; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%;" title="{{ task.assigned_to.get_full_name }}">
                        {{ task.assigned_to.get_full_name|default:task.assigned_to.username }}
                    </div>
                    <div style="font-size: 0.6rem; color: #666; margin-top: 1px;">
                        {{ task.assigned_to.department.name|default:"Sin Depto." }}
                    </div>
                    <div style="font-size: 0.55rem; color: #047d7d; font-weight: bold; text-transform: uppercase;">
                        {{ task.assigned_to.role.name|default:"Sin Rol" }}
                    </div>
                </div>
            {% else %}
                <div class="avatar-circle" style="width: 42px; height: 42px; border-radius: 50%; background: #eee; color: #aaa; font-size: 20px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-user-slash"></i>
                </div>
                <div style="font-size: 0.6rem; color: #aaa; margin-top: 4px;">Sin asignar</div>
            {% endif %}
        </div>

        <!-- Descripción y Comentarios (Derecha) -->
        <div style="flex: 1; overflow: hidden; display: flex; flex-direction: column; justify-content: space-between; height: 100%;">
            <div class="task-desc text-muted" style="font-size: 0.75rem; line-height: 1.2; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">
                {{ task.description|default:"Sin descripción" }}
            </div>
            
            <div class="d-flex justify-content-between align-items-center" style="margin-top: auto;">
                <div class="task-date text-muted" style="font-size: 0.6rem;">
                    <i class="far fa-calendar-alt me-1"></i>{{ task.created_at|date:"d/m/y H:i" }}
                </div>
                
                <a href="javascript:void(0)" class="comment-pill" onclick="openCommentsModal('{{ task.id }}', '{{ task.title|escapejs }}')" style="text-decoration: none; font-size: 0.85rem; color: #047d7d; display: flex; align-items: center; gap: 4px; font-weight: bold;">
                    <i class="far fa-comment-alt"></i>
                    <span>{{ task.comments.count }}</span>
                </a>
            </div>
        </div>
    </div>
</div>
