{% extends 'properties/base_dashboard.html' %}
{% load static %}

{% block title %}Crear Requerimiento - Janis Platform{% endblock %}
                        <!-- Sección: Datos del cliente -->
                        <div class="mb-4">
                            <h5 class="fw-bold mb-3">DATOS DEL CLIENTE</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label" for="{{ form.client_name.id_for_label }}">Nombre del cliente</label>
                                    {{ form.client_name }}
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label" for="{{ form.phone.id_for_label }}">Teléfono</label>
                                    {{ form.phone }}
                                </div>
                            </div>
                        </div>

                        <!-- Sección: Tipo de inmueble -->
                        <div class="mb-4">
                            <h5 class="fw-bold mb-3">TIPO DE INMUEBLE</h5>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.property_type.id_for_label }}">Tipo</label>
                                    {{ form.property_type }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.property_subtype.id_for_label }}">Subtipo</label>
                                    {{ form.property_subtype }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.area_type.id_for_label }}">Área terreno - Tipo</label>
                                    {{ form.area_type }}
                                </div>
                            </div>
                            <div class="row g-3 mt-2">
                                <div class="col-md-6">
                                    <label class="form-label" for="{{ form.land_area_min.id_for_label }}">Mínimo (m²)</label>
                                    {{ form.land_area_min }}
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label" for="{{ form.land_area_max.id_for_label }}">Máximo (m²)</label>
                                    {{ form.land_area_max }}
                                </div>
                            </div>
                            <div class="row g-3 mt-2">
                                <div class="col-md-12">
                                    <label class="form-label" for="{{ form.land_area_approx.id_for_label }}">Área aproximada (m²)</label>
                                    {{ form.land_area_approx }}
                                </div>
                            </div>
                        </div>

                        <!-- Sección: Ubicación -->
                        <div class="mb-4">
                            <h5 class="fw-bold mb-3">UBICACIÓN</h5>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.department.id_for_label }}">Departamento</label>
                                    {{ form.department }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.province.id_for_label }}">Provincia</label>
                                    {{ form.province }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.district.id_for_label }}">Distrito(s)</label>
                                    <div class="small text-muted mb-1">Puedes seleccionar varios distritos (Ctrl/Cmd + clic o usar la caja de búsqueda).</div>
                                    {{ form.district }}
                                </div>
                            </div>
                        </div>

                        <!-- Sección: Presupuesto -->
                        <div class="mb-4">
                            <h5 class="fw-bold mb-3">PRESUPUESTO</h5>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.budget_type.id_for_label }}">Tipo</label>
                                    {{ form.budget_type }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.budget_min.id_for_label }}">Mínimo</label>
                                    {{ form.budget_min }}
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label" for="{{ form.budget_max.id_for_label }}">Máximo</label>
                                    {{ form.budget_max }}
                                </div>
                            </div>
                            <div class="row g-3 mt-2">
                                <div class="col-md-6">
                                    <label class="form-label" for="{{ form.budget_approx.id_for_label }}">Aproximado</label>
                                    {{ form.budget_approx }}
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label" for="{{ form.currency.id_for_label }}">Moneda</label>
                                    {{ form.currency }}
                                </div>
                            </div>
                        </div>

                        <!-- Sección: Características -->
                        <div class="mb-4">
                            <h5 class="fw-bold mb-3">CARACTERÍSTICAS</h5>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label" for="{{ form.bedrooms.id_for_label }}">Habitaciones</label>
                                    {{ form.bedrooms }}
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label" for="{{ form.bathrooms.id_for_label }}">Baños</label>
                                    {{ form.bathrooms }}
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label" for="{{ form.half_bathrooms.id_for_label }}">Medios baños</label>
                                    {{ form.half_bathrooms }}
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label" for="{{ form.garage_spaces.id_for_label }}">Cochera</label>
                                    {{ form.garage_spaces }}
                                </div>
                            </div>
                            <div class="row g-3 mt-2">
                                <div class="col-12">
                                    <label class="form-label" for="{{ form.notes.id_for_label }}">Observaciones</label>
                                    {{ form.notes }}
                                </div>
                            </div>
                        </div>
                                {{ form.department }}
                            </div>
                            <div class="col-md-3">
                                <label class="form-label" for="{{ form.province.id_for_label }}">Provincia</label>
                                {{ form.province }}
                            </div>
                            <div class="col-md-12">
                                <label class="form-label" for="{{ form.district.id_for_label }}">Distritos (selección múltiple)</label>
                                <div class="small text-muted mb-1">Puedes seleccionar varios distritos (mantén Ctrl/Cmd o usa la caja de búsqueda).</div>
                                {{ form.district }}
                            </div>
                        </div>

                        <!-- Fila 7 – Características -->
                        <div class="row g-3 mt-2">
                            <div class="col-md-3">
                                <label class="form-label" for="{{ form.bedrooms.id_for_label }}">Habitaciones</label>
                                {{ form.bedrooms }}
                            </div>
                            <div class="col-md-3">
                                <label class="form-label" for="{{ form.bathrooms.id_for_label }}">Baños</label>
                                {{ form.bathrooms }}
                            </div>
                            <div class="col-md-3">
                                <label class="form-label" for="{{ form.half_bathrooms.id_for_label }}">Medios baños</label>
                                {{ form.half_bathrooms }}
                            </div>
                            <div class="col-md-3">
                                <label class="form-label" for="{{ form.garage_spaces.id_for_label }}">Cochera</label>
                                {{ form.garage_spaces }}
                            </div>
                        </div>

                        <!-- Fila 8 – Observaciones -->
                        <div class="row g-3 mt-2">
                            <div class="col-12">
                                <label class="form-label" for="{{ form.notes.id_for_label }}">Observaciones</label>
                                {{ form.notes }}
                            </div>
                        </div>

                        <!-- Botón guardar -->
                        <div class="row g-3 mt-2">
                            <div class="col-12 text-end">
                                <button class="btn btn-teal" type="submit">
                                    <i class="fas fa-save me-2"></i>Guardar
                                </button>
                            </div>
                        </div>
                        <script>
                        (function(){
                            function toggleArea() {
                                var at = document.getElementById("{{ form.area_type.id_for_label }}");
                                var approxRow = document.getElementById('area-approx-row');
                                var rangeRows = document.getElementById('area-range-rows');
                                if(!at) return;
                                var val = at.value || '';
                                if(val === 'approx'){
                                    if(approxRow) approxRow.style.display = '';
                                    if(rangeRows) rangeRows.style.display = 'none';
                                } else {
                                    if(approxRow) approxRow.style.display = 'none';
                                    if(rangeRows) rangeRows.style.display = '';
                                }
                            }
                            document.addEventListener('DOMContentLoaded', function(){
                                toggleArea();
                                var at = document.getElementById("{{ form.area_type.id_for_label }}");
                                if(at) at.addEventListener('change', toggleArea);
                            });
                        })();
                        </script>
                        <!-- Select2 para multi-select de distritos -->
                        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
                        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
                        <script>
                        (function(){
                            try{
                                document.addEventListener('DOMContentLoaded', function(){
                                    var $ = window.jQuery;
                                    if(!$) return;
                                    var sel = $('#{{ form.district.id_for_label }}');
                                    if(sel.length){
                                        sel.select2({
                                            placeholder: 'Selecciona distritos',
                                            width: '100%',
                                            allowClear: true
                                        });
                                    }
                                });
                            }catch(e){
                                console.warn('Select2 init failed', e);
                            }
                        })();
                        </script>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}